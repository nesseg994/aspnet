@using CloudKids.Domain.Entities
@model IEnumerable<CloudKids.Web.ViewModels.PublicationViewModel>

@{
    ViewBag.Title = "MyFeed";
}

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-modal/0.9.1/jquery.modal.min.css" />
<style>
    .green-border-focus .form-control:focus {
        border: 1px solid #8bc34a;
        box-shadow: 0 0 0 0.2rem rgba(139, 195, 74, .25);
        resize: none;
        width: 100%;
    }

    .center_div{
        margin: 0 auto;
        width:80% /* value of your choice which suits your alignment */
    }

    #myform:before {
        content: '';
        height: 100%;
        left: 0;
        position: absolute;
        top: 0;
        width: 100%;
        background-color: rgba(0,0,0,0.1);
        z-index: -1;
        border-radius: 2px;
    }

    

    body { padding-top:30px; }
    .widget .panel-body { padding:0px; }
    .widget .list-group { margin-bottom: 0; }
    .widget .panel-title { display:inline }
    .widget .label-info { float: right; }
    .widget li.list-group-item {border-radius: 0;border: 0;border-top: 1px solid #ddd;}
    .widget li.list-group-item:hover { background-color: rgba(86,61,124,.1); }
    .widget .mic-info { color: #666666;font-size: 11px; }
    .widget .action { margin-top:5px; }
    .widget .comment-text { font-size: 12px; }
    .widget .btn-block { border-top-left-radius:0px;border-top-right-radius:0px; }

    .post-comments {
        padding-bottom: 9px;
        margin: 5px 0 5px;
    }

    /* modal */
    .center-modal {
           position: absolute;
           left: 50%;
           top: 50%;
           transform: translate(-50%, -50%);
       }

    /* The Modal (background) */
    .modal {
        display: none; /* Hidden by default */
        position: fixed; /* Stay in place */
        z-index: 1000; /* Sit on top */
        padding-top: 100px; /* Location of the box */
        left: 0;
        top: 0;
        width: 100%; /* Full width */
        height: 100%; /* Full height */
        overflow: auto; /* Enable scroll if needed */
        background-color: rgb(0,0,0); /* Fallback color */
        background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
    }

    /* Modal Content */
    .modal-content {
        position: relative;
        background-color: #fefefe;
        margin: auto;
        padding: 0;
        border: 1px solid #888;
        width: 80%;
        box-shadow: 0 4px 8px 0 rgba(0,0,0,0.2),0 6px 20px 0 rgba(0,0,0,0.19);
        -webkit-animation-name: animatetop;
        -webkit-animation-duration: 0.4s;
        animation-name: animatetop;
        animation-duration: 0.4s
    }

    /* The Close Button */
    .close {
        color: white;
        float: right;
        font-size: 28px;
        font-weight: bold;
    }

    .close:hover,
    .close:focus {
        color: #000;
        text-decoration: none;
        cursor: pointer;
    }

    .modal-header {
        padding: 2px 16px;
        background-color: #5cb85c;
        color: white;
    }

    .modal-body {padding: 2px 16px;}

    .modal-footer {
        padding: 2px 16px;
        background-color: #5cb85c;
        color: white;
    }

    /* Add Animation */
    @@-webkit-keyframes animatetop {
    from {top:-300px; opacity:0} 
    to {top:0; opacity:1}
    }

    @@keyframes animatetop {
    from {top:-300px; opacity:0}
    to {top:0; opacity:1}
    }


/*.publishContainer {
        display: flex;
        align-items: center;
        justify-content: center;
        height: 100vh;
    }*/
</style>

<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.20/css/jquery.dataTables.css">

@*<h2>MyFeed</h2>

<p>
    @Html.ActionLink("Create New", "Create")
</p>
<table class="table">
    <tr>
        <th>
            @Html.DisplayNameFor(model => model.Author.Email)
        </th>
        <th>
            @Html.DisplayNameFor(model => model.Contenu)
        </th>
        <th>
            @Html.DisplayNameFor(model => model.DateAdded)
        </th>
        <th></th>
    </tr>

@foreach (var item in Model) {
    <tr>
        <td>
            @Html.DisplayFor(modelItem => item.Author.Email)
        </td>
        <td>
            @Html.DisplayFor(modelItem => item.Contenu)
        </td>
        <td>
            @Html.DisplayFor(modelItem => item.DateAdded)
        </td>
        <td>
            @Html.ActionLink("Edit", "Edit", new { id=item.Id }) |
            @Html.ActionLink("Details", "Details", new { id=item.Id }) |
            @Html.ActionLink("Delete", "Delete", new { id=item.Id })
        </td>
    </tr>
}

</table>*@

@*<section class="pager-sec">
    <div class="container">
        <div class="pager-pag" style="padding-top: 165px">
            <h3>My Feed</h3>
        </div><!--pager-pag end-->
    </div>
</section><!--pager-sec end-->

<section class="block6">
    <div class="row">
        <div class="col-md-6 mx-auto text-center form p-4">
            <form class="publishContainer justify-content-center" id="myform" action="http://localhost:1958/api/Publication">
                <!--Textarea with icon prefix-->
                <div class="form-group green-border-focus md-form text-area" style="width: 100%; margin: 18px 30%;">
                    <textarea class="md-textarea form-control contentTextArea" id="txtMessage" data-bind="value: newMessage, jqAutoresize: {}" style="width: 1000px; height: 150px;" placeholder="What's on your mind?" rows="3" cols="2000"></textarea>
                </div>
                <input class="btn btn-info" type="button" data-url="Publication/Create" value="Publish" id="btnShare" data-bind="click: addPost">
            </form>
        </div>
    </div>

    <div class="row">
        <div class="col-md-8">
            
            <ul id="msgHolder" data-bind="foreach: posts">
                    <li class="postHolder">
                            <img data-bind="attr: { src: AuthorAvatar }" src=""><p><a data-bind="text: AuthorName"></a>: <span data-bind=" html Message"></span></p>
                            <div class="postFooter">
                                <span class="timeago" data-bind="text: DatePosted"></span>&nbsp;<a class="linkComment" href="#" data-bind=" click toggleComment">Comment</a>
                                <div class="commentSection">
                                    <ul data-bind="foreach: PostComments">
                                        <li class="commentHolder">
                                            <img data-bind="attr: { src: AuthorAvatar }"><p><a data-bind="text: AuthorName"></a>: <span data-bind=" html Message"></span></p>
                                            <div class="commentFooter"> <span class="timeago" data-bind="text: DateCommented"></span>&nbsp;</div>
                                        </li>
                                    </ul>
                                    <div style="display: block" class="addCommentToPost">
                                        <textarea class="commentTextArea" data-bind="value: newCommentContent, jqAutoresize: {}" placeholder="write a comment..."></textarea>
                                        <input type="button" value="Comment" class="btnComment" data-bind="click: addComment" />
                                    </div>
                                </div>
                            </div>
                        </li>
                    
                </ul>
            <table id="msgHolder" class="table table-bordered table-hover">
                <thead>
                <tr>
                    <th>Post</th>
                    <th>Author</th>
                    <th>Delete</th>
                </tr>
                </thead>
                <tbody></tbody>
            </table>
            


            
        </div>
    </div>
</section>*@


<section class="pager-sec">
    <div class="container">
        <div class="pager-pag" style="padding-top: 165px">
            <h3>My Feed</h3>
            <h4>Browse News</h4>
        </div><!--pager-pag end-->
    </div>
</section><!--pager-sec end-->


<section class="block6">
    <!-- Trigger/Open The Modal -->
    <button id="myBtn">Open Modal</button>
<div class="row mb-5">
    <div class="col-md-6 mx-auto text-center form p-4">
        <form class="publishContainer justify-content-center" id="myform" action="http://localhost:1958/api/Publication">
            <!--Textarea with icon prefix-->
            <div class="form-group green-border-focus md-form text-area" style="width: 100%; margin: 18px 30%;">
                <textarea class="md-textarea form-control contentTextArea" id="txtMessage" data-bind="value: newMessage, jqAutoresize: {}" style="width: 1000px; height: 150px;" placeholder="What's on your mind?" rows="3" cols="2000"></textarea>
            </div>
            <input class="btn btn-info" type="button" data-url="Publication/Create" value="Publish" id="btnShare" data-bind="click: addPost">
        </form>
    </div>
</div>

<div class="container text-center">
<div class="blog-post-page">
<div class="row">
<div class="col-lg-9">
<div class="posts-page" id="postsBlog">
@if (Model != null)
{
    foreach (var post in Model)
    {
        if (post.Image == null)
        {
            <div class="post-blog">
                <h3 class="post-title"><a href="#" title="">Post</a></h3>
                <div class="quote-post">
                    <blockquote class="firstSentenceContent" data-id="@post.PostId">

                    </blockquote>
                </div><!--quote-post end-->
                <span class="post-date"><i class="fa fa-picture-o"></i>@post.DatePosted</span>
                <div class="blog-post-info">
                    <ul class="post-tg">
                        <li class="ad-author">
                            <span>By</span>
                            <a href="#" title="" class="ad-name">@post.AuthorName</a>
                        </li>
                        <li>
                            <i class="fa fa-sitemap"></i>
                            <a href="#" title="">Competitions,</a>
                            <a href="#" title="">News</a>
                        </li>
                        <li>
                            <i class="fa fa-comment-o"></i>
                            <a href="#" title="">
                                @if (post.Comments == null)
                                {
                                    <span class="commentInput" data-id="@post.PostId">No Comments</span>
                                }
                                else
                                {
                                    <span class="commentInput" data-id="@post.PostId">@post.Comments.Count() Comments</span>
                                }
                            </a>
                        </li>
                        <li>
                            <i class="fa fa-tags"></i>
                            <a href="#" title="">Tag 1,</a>
                            <a href="#" title="">Tag 2</a>
                        </li>
                    </ul>
                    <p class="postContent" id="postContent-@post.PostId">@post.Content</p>
                    <button class="continueReading" data-id="@post.PostId">Continue Reading</button>
                </div><!--blog-post-info end-->
            </div>

            // add comment
            <div class="post-comments" id="@post.PostId" style="visibility: hidden">
                <form>
                    <div class="form-group">
                        <label for="comment">Your Comment</label>
                        <textarea name="comment" class="form-control postCommentInput" data-id="@post.PostId" rows="3"></textarea>
                    </div>
                    <button type="submit" class="btn btn-default sendCommentBtn" data-id="@post.PostId">Send</button>
                </form>
            </div>

            // Comment Section
            if (post.Comments != null)
            {
                <div class="panel panel-default widget commentsDiv" data-id="@post.PostId" style="visibility: hidden">
                    <div class="panel-heading">
                        <span class="glyphicon glyphicon-comment"></span>
                        <h3 class="panel-title">
                            Recent Comments
                        </h3>
                        <span class="label label-info">
                            @post.Comments.Count()
                        </span>
                    </div>
                    <div class="panel panel-default widget">
                        <div class="panel-body">
                            <ul class="list-group" id="commentsUlList-@post.PostId">
                                @foreach (var comment in post.Comments)
                                {
                                    <li class="list-group-item commentsList" data-id="@comment.Id" data-author-id="@comment.AuthorId" data-post-id="@comment.PublicationId">
                                        <div class="row">
                                            <div class="col-xs-2 col-md-1">
                                                @if (comment.Author.Image == null)
                                                {
                                                    <img src="http://placehold.it/80" class="img-circle img-responsive" alt=""/>
                                                }
                                                else
                                                {
                                                    <img src="@comment.Author.Image" class="img-circle img-responsive" alt=""/>
                                                }
                                            </div>
                                            <div class="col-xs-10 col-md-11">
                                                <div>
                                                    <div class="mic-info">
                                                        By: <a href="#">@comment.Author.Name</a> on @comment.DateAdded
                                                    </div>
                                                </div>
                                                <div class="comment-text">
                                                    @comment.Contenu
                                                </div>
                                                @if (comment.AuthorId == 1) // Must change later with the current user's id
                                                {
                                                    <div class="action">
                                                        <button data-id="@comment.Id" type="button" class="btn btn-primary btn-xs editComment" title="Edit">
                                                            <span class="glyphicon glyphicon-pencil"></span>
                                                        </button>
                                                        @*<button data-id="@comment.Id" type="button" class="btn btn-success btn-xs " title="Approved">
                                                                    <span class="glyphicon glyphicon-ok"></span>
                                                                </button>*@
                                                        <button data-id="@comment.Id" type="button" class="btn btn-danger btn-xs deleteComment" title="Delete">
                                                            <span class="glyphicon glyphicon-trash"></span>
                                                        </button>
                                                    </div>
                                                }
                                            </div>
                                        </div>
                                    </li>
                                }
                            </ul>
                            <a href="#" class="btn btn-primary btn-sm btn-block" role="button"><span class="glyphicon glyphicon-refresh"></span> More</a>
                        </div>
                    </div>
                </div>
            }

            // Popup modal for edit & details
            <!-- Modal Popup -->
            <div data-modal-id="myModal" data-id="@post.PostId" class="modal fade PostPopup" role="dialog">
                <div class="modal-dialog">
                    <!-- Modal content-->
                    <div class="modal-content">
                        <div class="modal-header">
                            <h3 class="post-title"><a href="#" title="">Post</a></h3>
                            <div class="quote-post">
                                <blockquote class="firstSentenceContent" data-id="@post.PostId"></blockquote>
                            </div><!--quote-post end-->
                            <span class="post-date"><i class="fa fa-picture-o"></i>@post.DatePosted</span>
                        </div>
                        <div class="modal-body">
                            <div class="blog-post-info">
                                <ul class="post-tg">
                                    <li class="ad-author">
                                        <span>By</span>
                                        <a href="#" title="" class="ad-name">@post.AuthorName</a>
                                    </li>
                                    <li>
                                        <i class="fa fa-sitemap"></i>
                                        <a href="#" title="">Competitions,</a>
                                        <a href="#" title="">News</a>
                                    </li>
                                    <li>
                                        <i class="fa fa-comment-o"></i>
                                        <a href="#" title="">
                                            @if (post.Comments == null)
                                            {
                                                <span class="commentInput" data-id="@post.PostId">No Comments</span>
                                            }
                                            else
                                            {
                                                <span class="commentInput" data-id="@post.PostId">@post.Comments.Count() Comments</span>
                                            }
                                        </a>
                                    </li>
                                    <li>
                                        <i class="fa fa-tags"></i>
                                        <a href="#" title="">Tag 1,</a>
                                        <a href="#" title="">Tag 2</a>
                                    </li>
                                </ul>
                                <p class="postContent" id="postContent-@post.PostId">@post.Content</p>
                            </div><!--blog-post-info end-->
                        </div>
                        <div class="modal-footer">
                            <button data-id="@post.PostId" type="button" class="btn btn-danger close closeModal" data-dismiss="modal">
                                Close
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        }
        else
        {
            <div class="post-blog">
                <h3 class="post-title"><i class="fa fa-thumb-tack"></i><a href="#" title="">Post</a></h3>
                <div class="post-img">
                    <img src="images/resources/blog-img4.jpg" alt="">
                </div>
                <span class="post-date"><i class="fa fa-picture-o"></i>@post.DatePosted</span>
                <div class="blog-post-info">
                    <ul class="post-tg">
                        <li class="ad-author">
                            <span>By</span>
                            <a href="#" title="" class="ad-name">@post.AuthorName</a>
                        </li>
                        <li>
                            <i class="fa fa-sitemap"></i>
                            <a href="#" title="">Competitions,</a>
                            <a href="#" title="">News</a>
                        </li>
                        <li>
                            <i class="fa fa-comment-o"></i>
                            <a class="commentInput" data-id="@post.PostId" href="#" title="">No Comments</a>
                        </li>
                        <li>
                            <i class="fa fa-tags"></i>
                            <a href="#" title="">Tag 1,</a>
                            <a href="#" title="">Tag 2</a>
                        </li>
                    </ul>
                    <p>@post.Content</p>
                    <button class="continueReading" data-id="@post.PostId">Continue Reading</button>
                </div><!--blog-post-info end-->
            </div>
            <!--post-blog end-->
        }
    }
}
</div>
</div>
<div class="col-lg-3">
    <div class="right-sidebar">
        <div class="widget widget-text">
            <h3 class="widget-title">Text Widget</h3>
            <p>Elipsis magna a terminal nulla elementum morbi elite forte maecenas est magna vehicula est node maecenas.</p>
            <p> Praesent arcu gravida vehicula est node maecenas loareet morbi a dosis luctus. Urna eget lacinia eleifend praesent luctus a arcu quis facilisis venenatis. Aenean interdum, nibh vitae sodales, magna ante feugiat elit maecenas. </p>
        </div><!--widget-text end-->
        <div class="widget widget-categories">
            <h3 class="widget-title">Categories</h3>
            <ul>
                <li><a href="#" title="">Dance</a></li>
                <li><a href="#" title="">Education</a></li>
                <li><a href="#" title="">Events</a></li>
                <li><a href="#" title="">Fun</a></li>
                <li><a href="#" title="">General</a></li>
                <li><a href="#" title="">Games</a></li>
            </ul>
        </div><!--widget-categories end-->
        <div class="widget widget-tags">
            <h3 class="widget-title">Tags</h3>
            <ul>
                <li><a href="#" title="">Dance</a></li>
                <li><a href="#" title="">Education</a></li>
                <li><a href="#" title="">Play</a></li>
                <li><a href="#" title="">Story Time</a></li>
            </ul>
        </div><!--widget-tags end-->
        <div class="widget widget-calendar">
            <h3 class="widget-title">Calendar</h3>
            <table id="wp-calendar">
                <caption>December 2017</caption>
                <thead>
                <tr>
                    <th scope="col" title="Monday">M</th>
                    <th scope="col" title="Tuesday">T</th>
                    <th scope="col" title="Wednesday">W</th>
                    <th scope="col" title="Thursday">T</th>
                    <th scope="col" title="Friday">F</th>
                    <th scope="col" title="Saturday">S</th>
                    <th scope="col" title="Sunday">S</th>
                </tr>
                </thead>
                <tr>
                    <td colspan="4" class="pad">&nbsp;</td>
                    <td>1</td>
                    <td id="today">2</td>
                    <td>3</td>
                </tr>
                <tr>
                    <td>4</td>
                    <td>5</td>
                    <td>6</td>
                    <td>7</td>
                    <td>8</td>
                    <td>9</td>
                    <td>10</td>
                </tr>
                <tr>
                    <td>11</td>
                    <td>12</td>
                    <td>13</td>
                    <td>14</td>
                    <td>15</td>
                    <td>16</td>
                    <td>17</td>
                </tr>
                <tr>
                    <td>18</td>
                    <td>19</td>
                    <td>20</td>
                    <td>21</td>
                    <td>22</td>
                    <td>23</td>
                    <td>24</td>
                </tr>
                <tr>
                    <td>25</td>
                    <td>26</td>
                    <td>27</td>
                    <td>28</td>
                    <td>29</td>
                    <td>30</td>
                    <td>31</td>
                </tr>
                <tr>
                    <td colspan="2" id="prev"><a href="http://demo.cmssuperheroes.com/themeforest/wp-kindergarten/2015/05/">« May</a></td>
                    <td class="pad">&nbsp;</td>
                    <td colspan="3" id="next" class="pad">&nbsp;</td>
                </tr>
            </table>
        </div><!--widget-calendar end-->
        <div class="widget widget-posts">
            <h3 class="widget-title">Recent Posts</h3>
            <div class="blg-posts">
                <div class="blg-post">
                    <img src="images/resources/blg-img1.png" alt="">
                    <div class="blg-info">
                        <h3>Story Time</h3>
                        <span>May 13 2016 | by <a href="#" title="">admin</a></span>
                        <p>Elipsis magna a terminal nulla elementum morbi elite forte maecenas...</p>
                    </div>
                </div><!--blg-post end-->
                <div class="blg-post">
                    <img src="images/resources/blg-img1.png" alt="">
                    <div class="blg-info">
                        <h3>Reading Lessons</h3>
                        <span>May 13 2016 | by <a href="#" title="">admin</a></span>
                        <p>Elipsis magna a terminal nulla elementum morbi elite forte maecenas...</p>
                    </div>
                </div><!--blg-post end-->
                <div class="blg-post">
                    <img src="images/resources/blg-img1.png" alt="">
                    <div class="blg-info">
                        <h3>Education Through Play</h3>
                        <span>May 13 2016 | by <a href="#" title="">admin</a></span>
                        <p>Elipsis magna a terminal nulla elementum morbi elite forte maecenas...</p>
                    </div>
                </div><!--blg-post end-->
            </div><!--blg-posts end-->
        </div><!--widget-posts end-->
    </div><!--right-sidebar end-->
</div>
</div><!--blog_post end-->
</div>
</div>
</section>
<!-- The Modal -->
<div id="myModal" class="modal">

    <!-- Modal content -->
    <div class="modal-content">
        <div class="modal-header">
            <span class="close">&times;</span>
            <h2>Modal Header</h2>
        </div>
        <div class="modal-body">
            <p>Some text in the Modal Body</p>
            <p>Some other text...</p>
        </div>
        <div class="modal-footer">
            <h3>Modal Footer</h3>
        </div>
    </div>

</div>

@section scripts{
    <script src="~/Scripts/bootstrap.min.js"></script>
    <script src="~/Scripts/js/autosize.js"></script>
    <script src="~/Scripts/js/timeago.js"></script>
    <script src="~/Scripts/knockout-3.5.1.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/js/all.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-modal/0.9.1/jquery.modal.min.js"></script>

    @*<script src="~/Scripts/js/feed.js"></script>*@
    
    <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.10.20/js/jquery.dataTables.js"></script>
    
    @*<script type="text/javascript">
        $(function () {
            $("#btnShare").click(function () {
                $.post("/Publication/MyFeed/Create",
                    { name: $("#txtMessage").val() },
                    function (response) {
                        alert("Hello: " + response.Name + " .\nCurrent Date and Time: " + response.DateTime);
                    }
                );
            });
        });
    </script>*@
    
    <script type="text/javascript">
        $(document).ready(function () {
            // var table = dataTableDisplay();

            // display only first sentence in the blockquote
            var elems = $('.firstSentenceContent');
            elems.each(function () {
                var elem = $(this);
                var textParts = $("#postContent-" + elem.attr("data-id")).html().split(".");
                var first = "<span class='red'>" + textParts.shift() + ".</span>";
                elem.html(first);
            });

            // Disable the publish button if input is empty
            $('#btnShare').attr('disabled', true);
            $('#txtMessage').keyup(function () {
                if ($(this).val().length !== 0)
                    $('#btnShare').attr('disabled', false);
                else
                    $('#btnShare').attr('disabled', true);
            });


            // Define months enum
            Date.shortMonths = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];

            $("#btnShare").on("click", function (e) {
                e.preventDefault();

                console.log("Hey");

                var datum = {
                    Content: $("#txtMessage").val()
                };

                console.log(datum.Content);

                var post = new Post(datum);
                //post.Content(self.newContent());

                $.ajax({
                        url: "/api/Publication",
                        dataType: "json",
                        contentType: "application/json",
                        cache: false,
                        method: 'POST',
                        data: ko.toJSON(post)
                    })
                    .done(function (result) {
                        //self.Posts.splice(0, 0, new Post(result));
                        //self.newContent('');

                        var newPost = jQuery.parseJSON(result);

                        console.log(newPost);

                        var date = new Date(parseInt(newPost.DatePosted.substr(6)));
                        var dateTime = date.getDay() +
                            '-' +
                            Date.shortMonths[date.getMonth()] +
                            '-' +
                            date.getFullYear() +
                            ' ' +
                            date.getHours() +
                            ':' +
                            date.getMinutes() +
                            ':' +
                            date.getSeconds();
                        console.log(date);

                        var html = '<div class="post-blog">' +
                            '<h3 class="post-title"><i class="fa fa-thumb-tack"></i><a href="#" title="">' + 'Post' + '</a></h3>' +
                            '<div class="post-img">' +
                            '    <img src="images/resources/blog-img4.jpg" alt="">' +
                            '</div>' +
                            '<span class="post-date"><i class="fa fa-picture-o"></i>' + dateTime  + '</span>' +
                            '<div class="blog-post-info">' +
                            '    <ul class="post-tg">' +
                            '        <li class="ad-author">' +
                            '            <span>By</span>' +
                            '           <a href="#" title="" class="ad-name">' + newPost.AuthorName + '</a>' +
                            '       </li>' +
                            '       <li>' +
                            '           <i class="fa fa-sitemap"></i>' +
                            '           <a href="#" title="">Competitions,</a>' +
                            '           <a href="#" title="">News</a>' +
                            '       </li>' +
                            '       <li>' +
                            '           <i class="fa fa-comment-o"></i>' +
                            '           <a href="#" title="">No Comments</a>' +
                            '       </li>' +
                            '       <li>' +
                            '           <i class="fa fa-tags"></i>' +
                            '           <a href="#" title="">Tag 1,</a>' +
                            '           <a href="#" title="">Tag 2</a>' +
                            '       </li>' +
                            '   </ul>' +
                            '   <p>' + newPost.Content + '</p>' +
                            '   <button  class="continueReading" data-id="' + post.PostId + '">Continue Reading</button>' + // Change url to details page
                            '</div><!--blog-post-info end-->' +
                            '</div>';

                        $("#postsBlog").prepend(html);

                        //table.row.add([
                        //    {
                        //        "Content": newPost.Content,
                        //        "AuthorName": newPost.AuthorName,
                        //        "PostId": "<button class='btn-link js-delete' data-post-id=" + newPost.PostId + ">Delete</button>"
                        //    }
                        //]).draw();

                        //var table = $("#msgHolder").DataTable()
                        //    .row.add([
                        //        result.Content,
                        //        result.AuthorName,
                        //        "<button class='btn-link js-delete' data-post-id=" + result.PostId + ">Delete</button>"
                        //        ]);

                    })
                    .fail(function () {
                        console.log("Could not add post.");
                    });
            });

            $('body').delegate('.commentInput',
                'click',
                function (e) {
                    e.preventDefault();
                    var id = $(this).attr("data-id");
                    if ($('.post-comments#' + id).css('visibility') === 'hidden') {
                        $('.post-comments#' + id).css('visibility', 'visible');

                        if ($('.commentsDiv[data-id=' + id + ']').length > 0) {
                            console.log("For heaven's sake");
                            $('.commentsDiv[data-id=' + id + ']').css('visibility', 'visible');
                        }

                        // Disable button as long as input is empty
                        $('.sendCommentBtn[data-id=' + id + ']').attr('disabled', true);
                        $('.postCommentInput[data-id=' + id + ']').keyup(function() {
                            if ($(this).val().length !== 0)
                                $('.sendCommentBtn[data-id=' + id + ']').attr('disabled', false);
                            else
                                $('.sendCommentBtn[data-id=' + id + ']').attr('disabled', true);
                        });
                    } else {
                        $('.post-comments#' + id).css('visibility', 'hidden');

                        if ($('.commentsDiv[data-id=' + id + ']').length) {
                            $('.commentsDiv[data-id=' + id + ']').css('visibility', 'hidden');
                        }
                    }

                });

            $('body').delegate('.sendCommentBtn',
                'click',
                function(e) {
                    e.preventDefault();

                    var id = $(this).attr("data-id");

                    var datum = {
                        Content: $(".postCommentInput[data-id=" + id + "]").val(),
                        PostId: id
                    };

                    var comment = new Comment(datum);

                    $.ajax({
                            url: "/api/Commentaire",
                            dataType: "json",
                            contentType: "application/json",
                            cache: false,
                            method: 'POST',
                            data: ko.toJSON(comment)
                        })
                        .done(function (newComment) {

                            var comment = jQuery.parseJSON(newComment);

                            console.log(comment);

                            var html = '<li class="list-group-item commentsList" data-id="' +
                                comment.CommentId +
                                '" data-author-id="' +
                                comment.AuthorId +
                                '" data-post-id="' +
                                comment.PostId +
                                '>' +
                                '<div class="row">' +
                                '<div class="col-xs-2 col-md-1">';
                            if (comment.AuthorAvatar == null) {
                                html += '<img src="http://placehold.it/80" class="img-circle img-responsive" alt="" />';
                            } else {
                                html += '<img src="' + comment.AuthorAvatar + '" class="img-circle img-responsive" alt="" />';
                            }

                            html += '</div>' +
                                '<div class="col-xs-10 col-md-11">' +
                                '<div>' +
                                '<div class="mic-info">' +
                                '    By: <a href="#">' +
                                comment.AuthorName +
                                '</a> on ' +
                                comment.DateAdded +
                                '</div>' +
                                '</div>' +
                                '<div class="comment-text">' +
                                comment.Content +
                                '</div>';
                            if (comment.AuthorId === 1) // Must change later with the current user's id' +
                            {
                                html += '<div class="action">' +
                                    '<button type="button" class="btn btn-primary btn-xs" title="Edit">' +
                                    '<span class="glyphicon glyphicon-pencil"></span>' +
                                    '</button>' +
                                    '<button type="button" class="btn btn-danger btn-xs" title="Delete">' +
                                    '<span class="glyphicon glyphicon-trash"></span>' +
                                    '</button>' +
                                    '</div>';
                            }
                            html += '</div>' +
                                '</div>' +
                                '</li>';

                            $("#commentsUlList-" + comment.PostId).prepend(html);
                            console.log("Comment " + comment.PostId);
                        })
                        .fail(function () {
                            console.log("Could not add comment.");
                        });

                });


            // Post Popup Modal
            //$('body').delegate('.continueReading',
            //    'click',
            //    function(e) {
            //        var id = $(this).attr("data-id");
            //        console.log("Modal " + id);

            //    $(".PostPopup[data-id=" + id + "]").modal("show");
            //    });

            // Post Popup Modal
            //$('.continueReading').click(function (e) {
            //    var id = $(this).attr("data-id");
            //    console.log("Modal " + id);

            //    $(".PostPopup[data-id=" + id + "]").modal("show");
            //});

            //$('body').delegate('.continueReading',
            //        'click', function (event) {
            //            event.preventDefault();
            //            console.log("Modal");
            //            this.blur(); // Manually remove focus from clicked link.
            //            $.get(this.href, function (html) {
            //                $(html).appendTo('body').modal();
            //            });
            //});
        });

        function getTimeAgo(varDate) {
            if (varDate) {
                return $.timeago(varDate.toString().slice(-1) === 'Z' ? varDate : varDate + 'Z');
            }
            else {
                return '';
            }
        }


        function dataTableDisplay() {
            var table = $("#msgHolder").DataTable({
                ajax: {
                    url: "/api/Publication",  // must have / before api
                    dataSrc: ""
                },
                columns: [
                    {
                        data: "Content",
                        render: function (data, type, post) {
                            return "<a href='/Publication/Edit/" + post.Id + "'>" + post.Content + "</a>";
                        }
                    },
                    {
                        data: "AuthorName"
                    },
                    {
                        data: "PostId",
                        render: function (data, type, post) {
                            return "<button class='btn-link js-delete' data-post-id=" + post.PostId + ">Delete</button>";
                        }
                    }
                ]
            });

            return table;
        }

        function Post(data) {
            var self = this;
            data = data || {}; // if data is null => init to empty object

            console.log("datum " + data.Content);

            self.Content = ko.observable(data.Content || "");
            self.error = ko.observableArray();
        }

        function Comment(data) {
            var self = this; // the comment at hand

            // Properties that are persisted
            self.PostId = data.PostId;
            self.Content = ko.observable(data.Content || "");
            self.error = ko.observable();
        }


    </script>
    
    <script>
        // Get the modal
        //var modal = $(".PostPopup");

        // Get the button that opens the modal
        var btn = $(".continueReading");

        // Get the <span> element that closes the modal
        var span = document.getElementsByClassName("closeModal")[0];

        // When the user clicks the button, open the modal 
        btn.onclick = function () {
            var id = $(this).attr("data-id");
            var modal = $(".PostPopup[data-id=" + id + "]");
            modal.style.display = "block";
        }

        // When the user clicks on <span> (x), close the modal
        span.onclick = function () {
            var id = $(this).attr("data-id");
            var modal = $(".PostPopup[data-id=" + id + "]");
            modal.style.display = "none";
        }


        // Get the modal
        var modal = document.getElementById("myModal");

        // Get the button that opens the modal
        var btn = document.getElementById("myBtn");

        // Get the <span> element that closes the modal
        var span = document.getElementsByClassName("close")[0];

        // When the user clicks the button, open the modal 
        btn.onclick = function () {
            modal.style.display = "block";
        }

        // When the user clicks on <span> (x), close the modal
        span.onclick = function () {
            modal.style.display = "none";
        }

        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function (event) {
            if (event.target == modal) {
                modal.style.display = "none";
            }
        }

        // When the user clicks anywhere outside of the modal, close it
        //window.onclick = function(event) {
        //    if (event.target == modal) {
        //        modal.style.display = "none";
        //    }
        //}
    </script>
}